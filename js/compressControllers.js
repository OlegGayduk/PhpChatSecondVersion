"use strict";var date,clicked,loadMoreMsgs,loadMoreDialogs,preload,lastMsg,lastDialog,lastDate,msgGroupDate,checkWriterStatus,checkNewMsgs,avaMainSell,avaInterlocutor,msgSize,newMsgsTimer,msgsLocation,titleChange,endMsg=0,endMsg2=0,dialogsArr=new Array,myArr=new Array,usersInf=new Array,msgsArr=new Array,deleteMsgsArr=new Array,arr=new Array,arr2=new Array,selectorsOpacity=new Array,l=0,clickedMsg=0,sendMsgLocation=0,newMsgsArr=new Array,searchDialogsStr="",searchValue="",dialogsArrSearch=new Array,searchStrs=new Array,s=0,v=0,urls={showMsgsHistoryUrl:"../php/showMsgs.php",showDialogsUrl:"../php/showDialogs.php",searchDialogsUrl:"../php/searchDialogs.php",sendMsgUrl:"../php/sendMsg.php",logOutUrl:"../php/logOut.php",getMoreMsgsUrl:"../php/getMoreMsgs.php",writerStatusUrl:"../php/writerStatus.php",deleteWriterStatusUrl:"../php/deleteWriterStatus.php",deleteMsgsUrl:"../php/deleteMsgs.php",checkWriterStatusUrl:"../php/checkWriterStatus.php",checkNewMsgsUrl:"../php/checkNewMsgs.php",msgStatusChangeUrl:"../php/msgStatusChange.php",receiptUsersInfUrl:"../php/receiptUsersInf.php",receiptMyInfUrl:"../php/receiptMyInf.php",sendFileUrl:"../php/messFileUpload.php"},menuActs={new:function(){}};function getUrlParam(e,s){return decodeURI(e.replace(new RegExp("^(?:.*[&\\?]"+encodeURI(s).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))}function getDate(){var e=new Date;return 10<=e.getMinutes()?10<=e.getSeconds()?e.getHours()+":"+e.getMinutes()+":"+e.getSeconds():e.getHours()+":"+e.getMinutes()+":0"+e.getSeconds():10<=e.getSeconds()?e.getHours()+":0"+e.getMinutes()+":"+e.getSeconds():e.getHours()+":0"+e.getMinutes()+":0"+e.getSeconds()}var getElems={getIdElem:function(e){return null!=document.getElementById(e)&&document.getElementById(e)},getClassElem:function(e,s){return null!=document.getElementsByClassName(e)[s]&&document.getElementsByClassName(e)[s]},getTagElem:function(e,s){return null!=e&&null!=s&&e.getElementsByTagName(s)}},searchDialogsActs={searchOninput:function(e){""!=getElems.getClassElem("search-dialogs-field",0).value?(""!=searchValue?searchValue!=getElems.getClassElem("search-dialogs-field",0).value&&(searchValue>getElems.getClassElem("search-dialogs-field",0).value&&null!=dialogsArrSearch&&null!=dialogsArrSearch&&this.dialogsSearchArrReduction(searchValue,getElems.getClassElem("search-dialogs-field",0).value),searchValue=getElems.getClassElem("search-dialogs-field",0).value):searchValue=getElems.getClassElem("search-dialogs-field",0).value,getElems.getClassElem("cleanSearch",0).style.visibility="visible",getElems.getClassElem("nano-content",0).innerHTML="<div class='first-table'></div><div class='second-table'></div>",this.dialogsArrSearch(getElems.getClassElem("search-dialogs-field",0).value),0==getElems.getClassElem("main-msgs-history-preload",0)&&(getElems.getClassElem("second-table",0).innerHTML="<div class='main-msgs-history-preload'></div>"),xhr({type:"POST",url:urls.searchDialogsUrl,sendContent:"searchText="+encodeURIComponent(getElems.getClassElem("search-dialogs-field",0).value)+"&token="+encodeURIComponent(document.cookie.match(/CSRF-TOKEN=([\w-]+)/)[1]),elem:getElems.getClassElem("second-table",0)})):(getElems.getClassElem("cleanSearch",0).style.visibility="hidden",this.clean(e))},dialogsSearchArrReduction:function(e,t){for(var a=mainArrayEachCycle(JSON.parse(dialogsArr)),r=new Array,l=0,n=0;n<e.length;n++)null==t[n]&&(r[l++]=e[n]);for(var o=1;o<=a.length;o++)for(var i=0;i<JSON.parse(dialogsArr)[o].alias.length;i++)for(var g=0;g<=r.length;g++)r[g]==JSON.parse(dialogsArr)[o].alias[i]&&(r[g]=i);for(var c=1;c<dialogsArrSearch.length;c++)for(var m=0;m<=dialogsArrSearch[c].length;m++)for(var d=0;d<=r.length;d++)dialogsArrSearch[c][m]==r[d]&&(dialogsArrSearch[c].splice(m,1),s--)},dialogsArrSearch:function(e){if(null!=dialogsArr){var t=mainArrayEachCycle(JSON.parse(dialogsArr));null!=dialogsArrSearch&&null!=dialogsArrSearch||(dialogsArrSearch=new Array);for(var a=1;a<=t.length;a++)for(var r=0;r<JSON.parse(dialogsArr)[a].alias.length;r++)for(var l=0;l<e.length;l++)if(e[l]==JSON.parse(dialogsArr)[a].alias[r]){if(0==v?v=a:v!=a&&(s=0,v=a),null==dialogsArrSearch[a]||null==dialogsArrSearch[a])dialogsArrSearch[a]=new Array,dialogsArrSearch[a][s++]=r;else{for(var n=!0,o=0;o<=dialogsArrSearch[a].length;o++)dialogsArrSearch[a][o]==r&&(n=!1);if(0!=n){dialogsArrSearch[a][s++]=r;for(var i=0;i<=dialogsArrSearch[a].length;i++){if(dialogsArrSearch[a][i]>dialogsArrSearch[a][i+1]){var g=dialogsArrSearch[a][i+1];dialogsArrSearch[a][i+1]=dialogsArrSearch[a][i],dialogsArrSearch[a][i]=g}i+1==dialogsArrSearch[a].length&&(i=dialogsArrSearch[a].length)}this.dialogsArrSearchFetch(dialogsArrSearch[a],dialogsArrSearch[a].length)}}this.searchStrsCompose(JSON.parse(dialogsArr),a)}}},dialogsArrSearchFetch:function(e,s){for(var t=0;t<=s;t++){if(e[t]>e[t+1]){var a=e[t+1];e[t+1]=e[t],e[t]=a}t+1==s&&0<(t=s)-1&&this.dialogsArrSearchFetch(e,s-1)}},searchStrsCompose:function(e,s){for(var t=0;t<=dialogsArrSearch[s].length;t++)0==t?1<dialogsArrSearch[s].length?searchStrs[s]=e[s].alias.slice(0,dialogsArrSearch[s][t])+"<b style='color:#ccc'>"+e[s].alias.slice(dialogsArrSearch[s][t],dialogsArrSearch[s][t]+1)+"</b>":(searchStrs[s]=e[s].alias.slice(0,dialogsArrSearch[s][t])+"<b style='color:#ccc'>"+e[s].alias.slice(dialogsArrSearch[s][t],dialogsArrSearch[s][t]+1)+"</b>"+e[s].alias.slice(dialogsArrSearch[s][t]+1,e[s].alias.length),t=dialogsArrSearch[s].length,dialogsActs.dialogsHtmlAppend({alias:searchStrs[s]},e,s,getElems.getClassElem("first-table",0))):0<t&&1<dialogsArrSearch[s].length&&(1<dialogsArrSearch[s][t]-dialogsArrSearch[s][t-1]?searchStrs[s]=searchStrs[s]+e[s].alias.slice(dialogsArrSearch[s][t-1]+1,dialogsArrSearch[s][t])+"<b style='color:#ccc'>"+e[s].alias.slice(dialogsArrSearch[s][t],dialogsArrSearch[s][t]+1)+"</b>":searchStrs[s]=searchStrs[s]+"<b style='color:#ccc'>"+e[s].alias.slice(dialogsArrSearch[s][t],dialogsArrSearch[s][t]+1)+"</b>",t+1==dialogsArrSearch[s].length&&(searchStrs[s]=searchStrs[s]+e[s].alias.slice(dialogsArrSearch[s][t]+1,e[s].alias.length),t=dialogsArrSearch[s].length,dialogsActs.dialogsHtmlAppend({alias:searchStrs[s]},e,s,getElems.getClassElem("first-table",0))))},spanSearch:function(e,s,t){var a=getElems.getIdElem(e),r=getElems.getTagElem(a,"span");$(r[0]).html(s)},clean:function(e){s=0,dialogsArrSearch=null,getElems.getClassElem("cleanSearch",0).style.visibility="hidden",getElems.getClassElem("nano-content",0).innerHTML="",dialogsActs.parseJson(JSON.parse(dialogsArr),getElems.getClassElem("nano-content",0)),""!=window.location.search&&dialogsActs.colorChange({id:clicked,dialogColor:"rgb(70,90,124)",search:!0}),textAreaFocus("search-dialogs-field")}},msgsActs={showMsgsHistory:function(e){clicked!=e?(clearInterval(newMsgsTimer),""!=window.location.search&&this.msgsArrReduction(getUrlParam(location.search,"sell")),1==checkDialogExistance(e)&&(0!=getElems.getClassElem("no-more-msgs-preloader",0)&&getElems.getClassElem("msgs-history-selected",0).removeChild(getElems.getClassElem("no-more-msgs-preloader",0)),0!=getElems.getClassElem("msgs-history-settings-board",0)?this.msgsSetBoardAliasAppear(e):this.msgsSetBoardAppear(e),loadMoreMsgs=0,window.history.pushState("","","?sell="+e),window.history.replaceState("","","?sell="+e),null!=clicked&&dialogsActs.colorChange({id:clicked,dialogColor:"#fff"}),clicked=e,dialogsActs.colorChange({id:clicked,dialogColor:"rgb(70,90,124)"}),msgsActs.msgsPreloaderAppear(void 0),0==checkMsgsExistance(e)&&xhr({type:"GET",url:urls.showMsgsHistoryUrl+location.search,location:getUrlParam(location.search,"sell"),sendContent:0,elem:getElems.getClassElem("nano-content",1)}))):textAreaFocus("msgs-send-textarea")},msgSelectorStatus:function(e,s,t){var a=getElems.getIdElem(s).childNodes[0].childNodes[0];if(1!=e)return selectorsOpacity[s]=void 0,void(1==t?a.childNodes[0].style.opacity=.5:a.childNodes[0].style.visibility="hidden");selectorsOpacity[s]=a.childNodes[0],a.childNodes[0].style.opacity=e,a.childNodes[0].style.visibility="visible"},msgSelectValid:function(e){try{for(var s=0;s<=arr.length;s++)if(arr[s]==e)return l--,arr.splice(s,1),this.msgSelectorStatus(.5,e,1),!1}catch(e){alert("Ошибка1!")}return!0},msgIdCheck:function(e){if(null!=msgsArr[getUrlParam(location.search,"sell")]){for(var s=!1,t=mainArrayEachCycle(JSON.parse(msgsArr[getUrlParam(location.search,"sell")])),a=1;a<=t.length;a++)JSON.parse(msgsArr[getUrlParam(location.search,"sell")])[a].main_id==e&&(s=!0);return s}alert("Ошибка2!")},msgsSelect:function(e){0!=this.msgIdCheck(e)&&(0<arr.length?0!=this.msgSelectValid(e)&&(arr[l++]=e,this.msgSelectorStatus(1,e,1)):(arr[l++]=e,this.msgSelectorStatus(1,e,1)),this.selectBoardAppear())},selectBoardAppear:function(){0<arr.length?getElems.getClassElem("msgs-send-form-wrap",0).innerHTML="<div class='msgs-history-forward-btn'>Переслать <span style='color:#b9cfe3'>"+arr.length+"</span></div><div class='msgs-history-repeat-btn'>Повторить <span style='color:#b9cfe3'>"+arr.length+"</span></div><div class='msgs-history-delete-btn' onclick='msgsActs.deleteMsgs()'>Удалить <span style='color:#b9cfe3'>"+arr.length+"</span></div><div class='msgs-history-cancel-btn' onclick='msgsActs.selectCancel()'>Отмена</div>":(getElems.getClassElem("msgs-send-form-wrap",0).innerHTML="<div class='msgs-ava-interlocutor'></div> <div class='msgs-ava-main-seller'></div> <form id='msgs-send-form' method='post'> <textarea class='msgs-send-textarea' contenteditable='true' onkeydown='msgsActs.sendMsgFromKey(event)' oninput='msgsActs.writerStatus(this)' placeholder='Напишите сообщение...' name='text'></textarea> <span type='submit' class='msgs-history-send-btn' onclick='msgsActs.sendMsgMain(event)'>ОТПРАВИТЬ</span> </form> <div class='bottom-send-panel'> <div class='send-media'> <form name='uploadFile' id='upload' method='post' enctype='multipart/form-data'> <input name='filename' class='im_attach_input' size='28' multiple='multiple' title='Send file' type='file' onchange='messFileUploadActs.fileUpload(this,uploadFile);'> </form> </div> <div class='send-photos'> <form name='uploadMedia' id='upload' method='post' enctype='multipart/form-data'> <input name='filename' class='im_media_attach_input' size='28' multiple='multiple' accept='image/*, video/*, audio/*' title='Send media' type='file' onchange='messFileUploadActs.fileUpload(this,uploadMedia);'> </form> </div> </div>",getElems.getClassElem("msgs-send-textarea",0).focus())},selectCancel:function(){for(var e=0;e<arr.length;e++)0!=getElems.getIdElem(arr[e])&&this.msgSelectorStatus(.5,arr[e],0);for(e=0;e<arr.length;e++)l--,arr.splice(e,1),e<=arr.length&&e--;this.selectBoardAppear()},deleteMsgs:function(){var e=getElems.getClassElem("msgs-send-form-wrap",0),s=document.createElement("div");s.className="msgs-delete-preloader",e.insertBefore(s,e.childNodes[3]),this.deleteMsgsRequestControl(msgsArr[getUrlParam(location.search,"sell")],getUrlParam(location.search,"sell"))},deleteMsgsRequestControl:function(e,s){var t=this.deleteLastMsgCheck(e,s);xhr(0==t?{type:"POST",url:urls.deleteMsgsUrl+location.search,location:s,sendContent:"msgs="+encodeURIComponent(JSON.stringify(arr)),elem:0}:{type:"POST",url:urls.deleteMsgsUrl+location.search,location:s,sendContent:"msgs="+encodeURIComponent(JSON.stringify(arr))+"&lastMsgText="+encodeURIComponent(t.msgText)+"&lastMsgDateDay="+encodeURIComponent(t.msgDate)+"&id="+encodeURIComponent(t.id),elem:0})},deleteLastMsgCheck:function(e,s){var t=mainArrayEachCycle(JSON.parse(e)),a=1;if(!(1<t.length&&0<t.length-a))return JSON.parse(e)[t.length].otpr_id!=s?{msgText:"The chat is empty.",msgDate:this.dateDayForMsg(),id:JSON.parse(e)[t.length].otpr_id}:{msgText:"The chat is empty.",msgDate:this.dateDayForMsg(),id:JSON.parse(e)[t.length].poluch_id};for(var r=0;r<=arr.length;r++)JSON.parse(e)[t.length-a].main_id==arr[r]&&a++;for(var l=0;l<=arr.length;l++)if(JSON.parse(e)[t.length].main_id==arr[l])return JSON.parse(e)[t.length-a].otpr_id!=s?{msgText:JSON.parse(e)[t.length-a].text,msgDate:JSON.parse(e)[t.length-a].date_day,id:JSON.parse(e)[t.length-a].otpr_id}:{msgText:JSON.parse(e)[t.length-a].text,msgDate:JSON.parse(e)[t.length-a].date_day,id:JSON.parse(e)[t.length-a].poluch_id};return!1},msgsMouseOver:function(e){var s=getElems.getIdElem(e).childNodes[0].childNodes[0],t=document.createElement("i");t.className="msg-selector",null==selectorsOpacity[e]&&s.insertBefore(t,s.childNodes[0])},msgsMouseOut:function(e){var s=getElems.getIdElem(e).childNodes[0].childNodes[0];void 0===selectorsOpacity[e]&&s.removeChild(s.childNodes[0])},dateDayForMsg:function(){var e=new Date;if(e.getDate()<10)if(e.getMonth()+1<10)var s="0"+e.getDate()+".0"+(e.getMonth()+1)+"."+e.getFullYear().toString().substr(-2);else s="0"+e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear().toString().substr(-2);else s=e.getMonth()+1<10?e.getDate()+".0"+(e.getMonth()+1)+"."+e.getFullYear().toString().substr(-2):e.getDate()<10&&e.getMonth()+1<10?"0"+e.getDate()+".0"+(e.getMonth()+1)+"."+e.getFullYear().toString().substr(-2):e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear().toString().substr(-2);return s},msgDateCheck:function(e,s){var t=new Date;if(7==s.length)var a=s.slice(0,1);else if(8==s.length)a=s.slice(0,2);return t.getDate()==a?e:1<(a=t.getDate()-a)?s:"Yesterday"},sendMsgPreloader:function(e,s){var t=getElems.getIdElem(e).childNodes[0],a=document.createElement("div");if(a.className="min-preloader",t.insertBefore(a,t.childNodes[0]),0!=checkDialogExistance(s)){var r=getElems.getIdElem(s),l=document.createElement("div");l.className="min-dialog-preloader",r.insertBefore(l,r.childNodes[2])}},sendMsgPreloaderEnd:function(e,s,t){if(0!=getElems.getIdElem(s)){var a=getElems.getIdElem(s).childNodes[0];a.removeChild(a.childNodes[0])}var r=getElems.getIdElem(t);r.removeChild(r.childNodes[2])},sendMsgMain:function(e){if(e.preventDefault(),""!=window.location.search){sendMsgLocation=getUrlParam(location.search,"sell");var s=sanitizeMsgValue(getElems.getClassElem("msgs-send-textarea",0).value);if(0==s)return!1;textAreaFocus("msgs-send-textarea"),lastDate=getDate();var t=this.msgsNumberGenerator();null!=document.cookie.match(/CSRF-TOKEN=([\w-]+)/)?xhr({type:"POST",url:urls.sendMsgUrl+"?sell="+sendMsgLocation,sendContent:"text="+encodeURIComponent(s)+"&mainId="+encodeURIComponent(t)+"&dateMin="+encodeURIComponent(lastDate)+"&dateDay="+encodeURIComponent(this.dateDayForMsg())+"&token="+encodeURIComponent(document.cookie.match(/CSRF-TOKEN=([\w-]+)/)[1]),elem:0,id:t}):window.location.href="http://localhost:8081/mess/php/login.html",this.sendMsgDialogChange(sendMsgLocation,{text:s,date:this.dateDayForMsg()});var a=getElems.getClassElem("nano-content",1).scrollHeight;0==getElems.getClassElem("msgs-history-selected",0)&&$(getElems.getClassElem("nano-content",1)).append("<div class='msgs-history-selected'></div>"),$(getElems.getClassElem("msgs-history-selected",0)).append("<div class='msg-wrap' onclick='msgsActs.msgsSelect("+t+")' id="+t+" onmouseover='msgsActs.msgsMouseOver("+t+")' onmouseout='msgsActs.msgsMouseOut("+t+")'><div class='msg-wrap-big msg-unread'><div class='msg-content'><span class='msg-date'>"+lastDate+"</span><div class='msg-body msg-body-min'><div class='msg-content-text'><span class='msg-text'>"+s+"</span></div></div></div></div>"),this.sendMsgPreloader(t,sendMsgLocation),this.msgsHistorySelectedChange(a)}else getElems.getClassElem("msgs-send-textarea",0).focus()},msgsNumberGenerator:function(){for(var e,s=999,t=[],a=[];s--;)t.push(s+1);for(;t.length;)e=Math.round(Math.random()*(t.length-1)),a.push(t[e]),t.splice(e,1);return a[Math.floor(998*Math.random())]},sendMsgDialogChange:function(e,s){var t=getElems.getIdElem(e),a=getElems.getTagElem(t,"span");20<=s.text.length&&(s.text=s.text.slice(0,20)+"..."),a[1].innerHTML=s.date,a[2].innerHTML=s.text},msgGroupDateTitleCycle:function(e,s){for(var t=0;t<=getElems.getClassElem("msgs-history-selected",0).childNodes.length;t++)null!=getElems.getClassElem("msgs-history-selected",0).childNodes[t]&&getElems.getClassElem("msgs-history-selected",0).childNodes[t].id==e&&getElems.getClassElem("msgs-history-selected",0).insertBefore(s,getElems.getClassElem("msgs-history-selected",0).childNodes[t])},msgGroupDateTitle:function(e,s,t,a){var r=document.createElement("span");if(r.className="msgs-group-date-style","Yesterday"==s&&"Yesterday"!=msgGroupDate)r.innerHTML="Yesterday",this.msgGroupDateTitleCycle(e,r),msgGroupDate="Yesterday";else if(s==a&&""==msgGroupDate)r.innerHTML=s,this.msgGroupDateTitleCycle(e,r),msgGroupDate=s;else{if(s!=t||""==msgGroupDate||"Today"==msgGroupDate)return;r.innerHTML="Today",this.msgGroupDateTitleCycle(e,r),msgGroupDate="Today"}},msgsHistoryAppend:function(e,s,t){var a=getElems.getClassElem("nano-content",1).scrollHeight;1==s&&(lastMsg=e[s].id),s==t.length&&(endMsg=e[s].id),0==getElems.getClassElem("msgs-history-selected",0)&&$(getElems.getClassElem("nano-content",1)).append("<div class='msgs-history-selected'></div>"),0==getElems.getClassElem("msgs-history-typing-wrap",0)&&$(getElems.getClassElem("nano-content",1)).append("<div class='msgs-history-typing-wrap'><span class='msgs-history-typing-wrap-text'></span></div>");var r=this.msgDateCheck(e[s].date,e[s].date_day);return"unread"!=e[s].status?$(getElems.getClassElem("msgs-history-selected",0)).append("<div class='msg-wrap' onclick='msgsActs.msgsSelect("+e[s].main_id+")' id="+e[s].main_id+" onmouseover='msgsActs.msgsMouseOver("+e[s].main_id+")' onmouseout='msgsActs.msgsMouseOut("+e[s].id+")'><div class='msg-wrap-big'><div class='msg-content'><span class='msg-date'>"+r+"</span><div class='msg-body msg-body-min'><div class='msg-content-text'><span class='msg-text'>"+e[s].text+"</span></div></div></div></div>"):$(getElems.getClassElem("msgs-history-selected",0)).append("<div class='msg-wrap' onclick='msgsActs.msgsSelect("+e[s].main_id+")' id="+e[s].main_id+" onmouseover='msgsActs.msgsMouseOver("+e[s].main_id+")' onmouseout='msgsActs.msgsMouseOut("+e[s].main_id+")'><div class='msg-wrap-big msg-unread'><div class='msg-content'><span class='msg-date'>"+r+"</span><div class='msg-body msg-body-min'><div class='msg-content-text'><span class='msg-text'>"+e[s].text+"</span></div></div></div></div>"),this.msgGroupDateTitle(e[s].id,r,e[s].date,e[s].date_day),this.msgsHistorySelectedChange(a),0},newMsgsPrepend:function(e,s,t){s==t.length&&(lastMsg=e[s].id),"unread"!=e[s].status?$(getElems.getClassElem("msgs-history-selected",0)).prepend("<div class='msg-wrap' onclick='msgsActs.msgsSelect("+e[s].main_id+")' id="+e[s].main_id+" onmouseover='msgsActs.msgsMouseOver("+e[s].main_id+")' onmouseout='msgsActs.msgsMouseOut("+e[s].main_id+")'><div class='msg-wrap-big'><div class='msg-content'><span class='msg-date'>"+e[s].date+"</span><div class='msg-body msg-body-min'><div class='msg-content-text'><span class='msg-text'>"+e[s].text+"</span></div></div></div></div>"):$(getElems.getClassElem("msgs-history-selected",0)).prepend("<div class='msg-wrap' onclick='msgsActs.msgsSelect("+e[s].main_id+")' id="+e[s].main_id+" onmouseover='msgsActs.msgsMouseOver("+e[s].main_id+")' onmouseout='msgsActs.msgsMouseOut("+e[s].main_id+")'><div class='msg-wrap-big msg-unread'><div class='msg-content'><span class='msg-date'>"+e[s].date+"</span><div class='msg-body msg-body-min'><div class='msg-content-text'><span class='msg-text'>"+e[s].text+"</span></div></div></div></div>")},getEndMsgId:function(e){if("<span class='msgs-col-error'>The chat is empty.</span>"==e)return 0;var s=mainArrayEachCycle(JSON.parse(e));return JSON.parse(e)[s.length].id},getLastMsg:function(e){if("<span class='msgs-col-error'>The chat is empty.</span>"==e)return!1;var s=mainArrayEachCycle(JSON.parse(e));return{msgText:JSON.parse(e)[s.length].text,msgDate:JSON.parse(e)[s.length].date_day}},prependNewMsgsInArray:function(e,s){var t,a="",r=msgsArr[s],l=mainArrayEachCycle(JSON.parse(msgsArr[s])),n=mainArrayEachCycle(JSON.parse(e));l=l.length;for(var o=1;o<=n.length;o++)a+=this.makingNewString(++l,JSON.parse(e),o);t=(r=r.slice(0,r.length-1))+","+a.slice(0,a.length-1)+"}",msgsArr[s]=t},prependNewMsgsInArrayFromBack:function(e,s){msgsArr[s].slice(0,1),e.slice(0,e.search(/}}/)-1);for(var t,a=mainArrayEachCycle(JSON.parse(e)),r=mainArrayEachCycle(JSON.parse(msgsArr[s])),l="",n="",o=(a=a.length,1);o<=r.length;o++)l+=this.makingNewString(1+a++,JSON.parse(msgsArr[s]),o),o==r.length&&(a-=o);for(var i=1;i<=a;i++)n+=this.makingNewString(i,JSON.parse(e),a-(i-1));t="{"+n+(l=l.slice(0,l.length-1))+"}",msgsArr[s]=t},makingNewString:function(e,s,t){return"\n"==s[t].text[0]?s[t].text=s[t].text.slice(1,s[t].text.length):"\n"==s[t].text[s[t].text.length-1]&&(s[t].text=s[t].text.slice(0,s[t].text.length-2)),'"'+e+'":{"id":"'+s[t].id+'","main_id":"'+s[t].main_id+'","otpr_id":"'+s[t].otpr_id+'","ava":"'+s[t].ava+'","alias":"'+s[t].alias+'","text":"'+s[t].text+'","date":"'+s[t].date+'","date_day":"'+s[t].date_day+'","status":"'+s[t].status+'"},'},deleteMsgsFromArray:function(e,s){var t=mainArrayEachCycle(JSON.parse(msgsArr[s])),a="",r="";try{for(var l=1;l<=t.length;l++)if(JSON.parse(msgsArr[s])[l].main_id==e){var n=l;l=t.length+1}}catch(e){return!1}try{if(1!=n&&n!=t.length){for(var o=1;o<=n-1;o++)a+=this.makingNewString(o,JSON.parse(msgsArr[s]),o);for(var i=n+1;i<=t.length;i++)if(r+=this.makingNewString(n,JSON.parse(msgsArr[s]),i),n++,i==t.length){var g="{"+a+r.slice(0,r.length-1)+"}";msgsArr[s]=g}}else{if(1==n){for(var c=2;c<=t.length;c++)a+=this.makingNewString(c-1,JSON.parse(msgsArr[s]),c);return msgsArr[s]="{"+a.slice(0,a.length-1)+"}",!0}if(n==t.length){for(var m=1;m<=t.length-1;m++)a+=this.makingNewString(m,JSON.parse(msgsArr[s]),m);return msgsArr[s]="{"+a.slice(0,a.length-1)+"}",!0}}}catch(e){return alert(e),!1}},deleteMsgsFromHtml:function(e){var s=getElems.getClassElem("msgs-history-selected",0).scrollHeight;try{for(var t=0;t<arr.length;t++)0!=getElems.getIdElem(arr[t])&&(getElems.getIdElem(arr[t]).parentNode.removeChild(getElems.getIdElem(arr[t])),0!=this.deleteMsgsFromArray(arr[t],e)?getElems.getClassElem("msgs-history-selected",0).style.marginTop=getElems.getClassElem("msgs-history-selected",0).style.marginTop+getElems.getIdElem(arr[t]).scrollHeight:alert("Error!")),t+1==arr.length&&this.selectCancel(arr[t])}catch(e){return alert("Ошибка в Html!"),!1}this.heightAfterDeletedMsgs(s),$(".nano").nanoScroller(),"{}"==msgsArr[e]&&(getElems.getClassElem("nano-content",1).innerHTML="<span class='msgs-col-error'>The chat is empty.</span>",msgsArr[e]="<span class='msgs-col-error'>The chat is empty.</span>")},heightAfterDeletedMsgs:function(e){var s=e-getElems.getClassElem("msgs-history-selected",0).scrollHeight,t=getElems.getClassElem("msgs-history-selected",0).style.marginTop;if(getElems.getClassElem("nano-content",1).scrollHeight<=718&&getElems.getClassElem("msgs-history-selected",0).scrollHeight<=669){var a=+t.slice(0,t.length-2)+s;"0px"!=getElems.getClassElem("msgs-history-selected",0).style.marginTop?getElems.getClassElem("msgs-history-selected",0).style.marginTop=a+"px":getElems.getClassElem("msgs-history-selected",0).style.marginTop=getElems.getClassElem("nano-content",1).scrollHeight-getElems.getClassElem("msgs-history-selected",0).scrollHeight-30+"px"}},msgsHistorySelectedChange:function(e){getElems.getClassElem("msgs-history-selected",0).scrollHeight>e?getElems.getClassElem("msgs-history-selected",0).style.marginTop="0px":(getElems.getClassElem("msgs-history-selected",0).style.marginTop=e-getElems.getClassElem("msgs-history-selected",0).scrollHeight-30+"px",getElems.getClassElem("msgs-history-selected",0).scrollHeight>e-30&&(getElems.getClassElem("msgs-history-selected",0).style.marginTop="0px")),this.scrollMsgs()},msgsStringTransform:function(e,s){var t=mainArrayEachCycle(JSON.parse(e)),a="";try{for(var r=1;r<=t.length;r++)1==r?a+=this.makingNewString(r,JSON.parse(e),t.length):r==t.length?a+=this.makingNewString(r,JSON.parse(e),1):a+=this.makingNewString(r,JSON.parse(e),t.length-(r-1));return a="{"+a.slice(0,a.length-1)+"}",msgsArr[s]=a}catch(e){return alert("Error in transformation!"),!1}},msgsArrReduction:function(e){if("<span class='msgs-col-error'>The chat is empty.</span>"!=msgsArr[e]&&null!=msgsArr[e]){var s=mainArrayEachCycle(JSON.parse(msgsArr[e])),t="";if(30<s.length)try{for(var a=1;a<=s.length;a++)31!=a?1==a?t+=this.makingNewString(a,JSON.parse(msgsArr[e]),s.length):a==s.length?t+=this.makingNewString(a,JSON.parse(msgsArr[e]),1):t+=this.makingNewString(a,JSON.parse(msgsArr[e]),s.length-(a-1)):a=s.length+1;t="{"+t.slice(0,t.length-1)+"}",t=this.msgsStringTransform(t,e)}catch(e){alert(e)}}},msgStatusChange:function(e){for(var s=mainArrayEachCycle(JSON.parse(newMsgsArr[e])),t=new Array,a=1;a<=s.length;a++)t[a]=JSON.parse(newMsgsArr[e])[a].main_id;this.prependNewMsgsInArray(newMsgsArr[e],e),e==getUrlParam(location.search,"sell")&&this.parseJson("append",JSON.parse(newMsgsArr[e])),newMsgsArr[e]=void 0},msgsSetBoardAppear:function(e){var s=getElems.getIdElem("msgs-history-col-wrap"),t=document.createElement("div");t.className="msgs-history-settings-board",s.insertBefore(t,s.childNodes[0]);var a=getElems.getClassElem("msgs-history-settings-board",0),r=document.createElement("div");r.className="interlocutor";var l=document.createElement("div");l.className="msgs-history-search";var n=document.createElement("div");n.className="msgs-history-settings",a.insertBefore(l,a.childNodes[0]),a.insertBefore(r,a.childNodes[0]),a.insertBefore(n,a.childNodes[1]),this.msgsSetBoardAliasAppear(e)},spanSearch:function(e,s){var t=getElems.getIdElem(e),a=getElems.getTagElem(t,"span");$(a[1]).html(s)},newMsgsCircleAppear:function(e,s){var t=getElems.getIdElem(e),a=document.createElement("span");a.className="new-msgs-circle",t.insertBefore(a,t.childNodes[4]),$(t.childNodes[4]).html(s)},msgsSetBoardAliasAppear:function(e){if("<span class='empty-dialogs'>You haven't got any dialogs yet</span>"!=dialogsArr)for(var s=mainArrayEachCycle(JSON.parse(dialogsArr)),t=1;t<=s.length;t++)JSON.parse(dialogsArr)[t].id==e&&(getElems.getClassElem("interlocutor",0).innerHTML=JSON.parse(dialogsArr)[t].alias);else getElems.getClassElem("interlocutor",0).innerHTML="interlocutor"},removeMsgsSetBoard:function(){var e=getElems.getIdElem("msgs-history-col-wrap");e.removeChild(e.childNodes[0])},msgsPreloaderAppear:function(e){null==e&&0!=preload&&(getElems.getClassElem("nano-content",1).innerHTML="<div class='main-msgs-history-preload'></div>",getElems.getClassElem("msgs-send-form-wrap",0).style.visibility="visible",this.selectCancel(),textAreaFocus("msgs-send-textarea"))},sendMsgFromKey:function(e){"13"==e.keyCode&&0!=getElems.getClassElem("msgs-send-textarea",0)&&""!=getElems.getClassElem("msgs-send-textarea",0).value&&this.sendMsgMain(e)},scrollMsgs:function(){$(".nano").nanoScroller(),getElems.getClassElem("nano-content",1).scrollTop=getElems.getClassElem("nano-content",1).scrollHeight},getMoreMsgs:function(e){0!=loadMoreMsgs&&e.scrollTop<=100&&null!=msgsArr[getUrlParam(location.search,"sell")]&&"<span class='msgs-col-error'>The chat is empty.</span>"!=msgsArr[getUrlParam(location.search,"sell")]&&(loadMoreMsgs=0,xhr({type:"POST",url:urls.getMoreMsgsUrl+location.search,location:getUrlParam(location.search,"sell"),sendContent:"lastMsg="+encodeURIComponent(lastMsg),elem:getElems.getClassElem("nano-content",1)}))},parseJson:function(e,s){var t=mainArrayEachCycle(s);try{for(var a=1;a<=t.length;a++)null!=s[a]&&("append"==e?this.msgsHistoryAppend(s,a,t):this.newMsgsPrepend(s,a,t)),a==t.length&&(loadMoreMsgs=1)}catch(e){alert("Ошибка!"),alert(e)}return 0}},dialogsActs={colorChange:function(e){var s=getElems.getIdElem(e.id),t=getElems.getTagElem(s,"span");switch(e.dialogColor){case"rgb(70,90,124)":s.style.background=e.dialogColor,this.colorChangeCycl(t,e.dialogColor);break;case"#fff":msgsActs.selectCancel(),s.style.background="transparent",this.colorChangeCycl(t,e.dialogColor)}return 0},colorChangeCycl:function(e,s){if("#fff"==s)for(var t=["#000","#999","#666"],a=0;a<e.length;a++)e[a].style.color=t[a];else for(a=0;a<e.length;a++)e[a].style.color="#fff"},parseJson:function(e,s){var t=mainArrayEachCycle(e);try{for(var a=1;a<=t.length;a++)if(this.dialogsHtmlAppend("append",e,a,s),a==t.length)return lastDialog=e[a].n,msgsActs.scrollMsgs(),setInterval(function(){for(var e=new Array,s=1;s<=t.length;s++)e[s]=new Array,e[s][1]=JSON.parse(dialogsArr)[s].id,e[s][2]=JSON.parse(dialogsArr)[s].text_id;xhr({type:"POST",url:urls.checkNewMsgsUrl,sendContent:"data="+encodeURIComponent(JSON.stringify(e))+"&lastDialog="+encodeURIComponent(lastDialog),elem:getElems.getClassElem("nano-content",1)})},5e3),0}catch(e){alert("Ошибка!"),alert(e)}},dialogsHtmlAppend:function(e,s,t,a){var r=msgsActs.msgDateCheck(s[t].date_min,s[t].date_day);"append"==e?0!=s[t].ava?$(a).append("<div class='dialog-wrap' id="+s[t].id+" onclick='msgsActs.showMsgsHistory("+s[t].id+")'><img class='dialog-ava-wrap' src='"+s[t].ava+"'/><span id='dialog-seller'>"+s[t].alias+"</span><span id='dialog-date'>"+r+"</span><span id='dialog-last-msg'>"+s[t].text+"</span></div>"):$(a).append("<div class='dialog-wrap' id="+s[t].id+" onclick='msgsActs.showMsgsHistory("+s[t].id+")'><img class='dialog-ava-wrap' src='../assets/default/defAva.png'/><span id='dialog-seller'>"+s[t].alias+"</span><span id='dialog-date'>"+r+"</span><span id='dialog-last-msg'>"+s[t].text+"</span></div>"):0!=s[t].ava?a.innerHTML="<div class='dialog-wrap' id="+s[t].id+" onclick='msgsActs.showMsgsHistory("+s[t].id+")'><img class='dialog-ava-wrap' src='"+s[t].ava+"'/><span id='dialog-seller'>"+e.alias+"</span><span id='dialog-date'>"+r+"</span><span id='dialog-last-msg'>"+s[t].text+"</span></div>":a.innerHTML="<div class='dialog-wrap' id="+s[t].id+" onclick='msgsActs.showMsgsHistory("+s[t].id+")'><img class='dialog-ava-wrap' src='../assets/default/defAva.png'/><span id='dialog-seller'>"+e.alias+"</span><span id='dialog-date'>"+r+"</span><span id='dialog-last-msg'>"+s[t].text+"</span></div>"},makingNewString:function(e,s,t){return'"'+e+'":{"n":"'+s[t].n+'","id":"'+s[t].id+'","ava":"'+s[t].ava+'","alias":"'+s[t].alias+'","date_min":"'+s[t].date_min+'","date_day":"'+s[t].date_day+'","text":"'+s[t].text+'","text_id":"'+s[t].text_id},prependNewDialogsInArray:function(e){var s,t="",a=dialogsArr,r=mainArrayEachCycle(JSON.parse(dialogsArr)),l=mainArrayEachCycle(JSON.parse(e));r=r.length;for(var n=1;n<=l.length;n++)t+=this.makingNewString(++r,JSON.parse(e),n);s=(a=a.slice(0,a.length-1))+","+t.slice(0,t.length-1)+"}",dialogsArr=s},getMoreDialogs:function(e){e.scrollTop>=getElems.getClassElem("nano-content",0).scrollHeight-20&&xhr({type:"POST",url:urls.getMoreMsgsUrl+location.search,sendContent:"lastDialog="+encodeURIComponent(lastDialog),elem:getElems.getClassElem("nano-content",1)})}};function mainArrayEachCycle(e){var s=0,t=new Array;try{for(var a in e)t[s++]=a}catch(e){return!1}return t}function checkMsgsExistance(e){return null!=msgsArr[e]?(getElems.getClassElem("nano-content",1).innerHTML="","<span class='msgs-col-error'>The chat is empty.</span>"!=msgsArr[e]?msgsActs.parseJson("append",JSON.parse(msgsArr[e])):(msgsActs.scrollMsgs(),$(getElems.getClassElem("nano-content",1)).append(msgsArr[e])),1):0}function checkDialogExistance(e){for(var s=!1,t=mainArrayEachCycle(JSON.parse(dialogsArr)),a=1;a<=t.length;a++)JSON.parse(dialogsArr)[a].id==e&&(s=!0);return s}function getXhrType(){var s;try{s=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{s=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){s=!1}}return s||"undefined"==typeof XMLHttpRequest||(s=new XMLHttpRequest),s}function textAreaFocus(e){getElems.getClassElem(e,0).value="",getElems.getClassElem(e,0).focus()}function sanitizeMsgValue(e){return 0!==e.value&&(e.replace(/<[^>]+>/g,""),e)}function xhr(t){if(0==getXhrType())return alert("Fatal error"),!1;var a=getXhrType();switch(t.url){case urls.showMsgsHistoryUrl+location.search:a.onreadystatechange=function(){if(4==a.readyState){if(200==this.status){if(t.elem.innerHTML="",0!=a.responseText){if("<span class='msgs-col-error'>The chat is empty.</span>"==a.responseText)msgsArr[t.location]=a.responseText,getUrlParam(location.search,"sell")==t.location?($(t.elem).append(a.responseText),msgsActs.scrollMsgs()):null!=msgsArr[getUrlParam(location.search,"sell")]&&msgsActs.parseJson("append",JSON.parse(msgsArr[getUrlParam(location.search,"sell")]));else{var e=msgsActs.msgsStringTransform(a.responseText,t.location);if(0==e)return void alert("Error!");getUrlParam(location.search,"sell")==t.location?msgsActs.parseJson("append",JSON.parse(e)):null!=msgsArr[getUrlParam(location.search,"sell")]&&("<span class='msgs-col-error'>The chat is empty.</span>"!=msgsArr[getUrlParam(location.search,"sell")]?msgsActs.parseJson("append",JSON.parse(msgsArr[getUrlParam(location.search,"sell")])):($(t.elem).append(msgsArr[getUrlParam(location.search,"sell")]),msgsActs.scrollMsgs()))}0==getElems.getClassElem("msgs-history-settings-board",0)?msgsActs.msgsSetBoardAppear(t.location):msgsActs.msgsSetBoardAliasAppear(getUrlParam(location.search,"sell"))}else alert(a.responseText);loadMoreMsgs=1}else alert(a.status+": "+a.statusText);return a=null,0}};break;case urls.searchDialogsUrl:a.onreadystatechange=function(){4==a.readyState&&(200==this.status?(t.elem.innerHTML="",0!=getElems.getClassElem("second-table",0)&&(0!=a.responseText?dialogsActs.parseJson(JSON.parse(a.responseText),t.elem):getElems.getClassElem("second-table",0).innerHTML="<span class='empty-dialogs'>There aren't any matches for this request..</span>")):alert(a.status+": "+a.statusText),a=null)};break;case urls.showDialogsUrl+location.search:a.onreadystatechange=function(){4==a.readyState&&(200==this.status?(t.elem.innerHTML="",0!=a.responseText?(dialogsArr=a.responseText,dialogsActs.parseJson(JSON.parse(a.responseText),t.elem),""!=window.location.search&&0!=getElems.getIdElem(getUrlParam(location.search,"sell"))&&(clicked=getUrlParam(location.search,"sell"),dialogsActs.colorChange({id:clicked,dialogColor:"rgb(70,90,124)"}))):(window.loadMoreDialogs=!1,$(getElems.getClassElem("nano-content",0)).append("<span class='empty-dialogs'>You haven't got any dialogs yet</span>"))):alert(a.status+": "+a.statusText),a=null)};break;case urls.sendMsgUrl+location.search:a.onreadystatechange=function(){4==a.readyState&&(200==this.status?0!=a.responseText?(null==msgsArr[sendMsgLocation]?msgsArr[sendMsgLocation]=a.responseText:"<span class='msgs-col-error'>The chat is empty.</span>"!=msgsArr[sendMsgLocation]?msgsActs.prependNewMsgsInArray(a.responseText,sendMsgLocation):msgsArr[sendMsgLocation]=a.responseText,msgsActs.sendMsgPreloaderEnd(1,t.id,sendMsgLocation)):alert(a.responseText):alert(a.status+": "+a.statusText),a=null)};break;case urls.getMoreMsgsUrl+location.search:a.onreadystatechange=function(){if(4==a.readyState){if(200==a.status)if(0!=a.responseText){var e=a.responseText;if("There is no more!"==(e=e.slice(e.search(/}}/)+2,e.length)))return loadMoreMsgs=0,$(getElems.getClassElem("msgs-history-selected",0)).prepend("<div class='no-more-msgs-wrap'><span class='no-more-msgs-text'>There is no more.</span></div>"),0;if(loadMoreMsgs=1,msgsActs.prependNewMsgsInArrayFromBack(e,t.location),getUrlParam(location.search,"sell")!=t.location)return;var s=t.elem.scrollHeight-t.elem.scrollTop;msgsActs.parseJson("prepend",JSON.parse(e)),$(".nano").nanoScroller(),t.elem.scrollTop=t.elem.scrollHeight-s}else loadMoreMsgs=0;else alert(a.status+": "+a.statusText);a=null}};break;case urls.deleteMsgsUrl+location.search:a.onreadystatechange=function(){if(4==a.readyState){if(200==this.status){msgsActs.deleteMsgsFromHtml(t.location);var e=msgsActs.getLastMsg(msgsArr[t.location]);0!=e?msgsActs.sendMsgDialogChange(t.location,{text:e.msgText,date:e.msgDate}):msgsActs.sendMsgDialogChange(t.location,{text:"The chat is empty.",date:this.dateDayForMsg()}),getElems.getClassElem("msgs-send-form-wrap",0).removeChild(getElems.getClassElem("msgs-send-form-wrap",0).childNodes[3])}else alert(a.status+": "+a.statusText);a=null}};break;case urls.checkNewMsgsUrl:a.onreadystatechange=function(){if(4==a.readyState){if(200==this.status){if(0!=a.responseText)if(alert(a.responseText),null==JSON.parse(a.responseText)[1].n)for(var e=0;e<=a.responseText.length;e++)0!=getElems.getIdElem(JSON.parse(a.responseText[e]).otpr_id)?(msgsActs.newMsgsCircleAppear(JSON.parse(a.responseText[e]).otpr_id,mainArrayEachCycle(JSON.parse(a.responseText[e]))),msgsActs.spanSearch(JSON.parse(a.responseText[e]).otpr_id,JSON.parse(a.responseText[e]).text)):0!=getElems.getIdElem(JSON.parse(a.responseText[e]).poluch_id)&&(msgsActs.newMsgsCircleAppear(JSON.parse(a.responseText[e]).poluch_id,mainArrayEachCycle(JSON.parse(a.responseText[e]))),msgsActs.spanSearch(JSON.parse(a.responseText[e]).poluch_id,JSON.parse(a.responseText[e]).text)),""!=window.location.search&&msgsActs.prependNewMsgsInArray(JSON.parse(a.responseText[e]),getUrlParam(location.search,"sell"));else dialogsActs.parseJson(JSON.parse(a.responseText),t.elem),dialogsActs.prependNewDialogsInArray(JSON.parse(a.responseText))}else alert(a.status+": "+a.statusText);a=null}}}return a.open(t.type,t.url,!0),a.setRequestHeader("Cache-Control","no-cache"),t.url!=urls.sendFileUrl&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),0!=t.sendContent?a.send(t.sendContent):a.send(),0}window.onpopstate=function(){msgsActs.msgsArrReduction(getUrlParam(location.search,"sell")),getElems.getClassElem("tg-head-main-peer-wrap",0).innerHTML="",null!=clicked&&dialogsActs.colorChange({id:clicked,dialogColor:"#fff"}),clicked=null,""!=window.location.search?(0!=getElems.getIdElem(getUrlParam(location.search,"sell"))&&(clicked=getUrlParam(location.search,"sell"),dialogsActs.colorChange({id:clicked,dialogColor:"rgb(70,90,124)"})),msgsActs.msgsPreloaderAppear(void 0),msgsActs.msgsSetBoardAliasAppear(getUrlParam(location.search,"sell")),0==checkMsgsExistance(getUrlParam(location.search,"sell"))&&xhr({type:"GET",url:urls.showMsgsHistoryUrl+location.search,location:getUrlParam(location.search,"sell"),sendContent:0,elem:getElems.getClassElem("nano-content",1)})):(msgsActs.removeMsgsSetBoard(),getElems.getClassElem("nano-content",1).innerHTML="",getElems.getClassElem("msgs-send-form-wrap",0).style.visibility="hidden",$(getElems.getClassElem("nano-content",1)).append("<span class='msgs-col-error'>Choose the dialog to begin chat</span>"),msgsActs.scrollMsgs())},window.onload=function(){getElems.getClassElem("nano-content",0).innerHTML="<div class='main-msgs-history-preload'></div>",xhr({type:"GET",url:urls.showDialogsUrl+location.search,sendContent:0,elem:getElems.getClassElem("nano-content",0)}),""!=window.location.search?(msgsLocation=getUrlParam(location.search,"sell"),0!=getElems.getIdElem(getUrlParam(location.search,"sell"))&&(clicked=getUrlParam(location.search,"sell"),dialogsActs.colorChange({id:clicked,dialogColor:"rgb(70,90,124)"})),msgsActs.msgsPreloaderAppear(void 0),xhr({type:"GET",url:urls.showMsgsHistoryUrl+location.search,location:getUrlParam(location.search,"sell"),sendContent:0,elem:getElems.getClassElem("nano-content",1)})):$(getElems.getClassElem("nano-content",1)).append("<span class='msgs-col-error'>Choose the dialog to begin chat</span>")};